<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Questrial&family=Noto+Sans+JP:wght@700;900&display=swap" rel="stylesheet">
  <title>Landing</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      overflow-x: hidden;
      background: black;
    }

    .background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      background-image: url('assets/bg_2.png');
      background-size: 100% auto;
      background-repeat: no-repeat;
      background-position: top center;
      z-index: 1;
    }

    @media (max-width: 768px) {
      .background {
        background-image: url('assets/bg_3.png');
      }
    }

    .foreground {
      position: fixed;
      left: 0;
      width: 100%;
      z-index: 2;
    }

    #fg1 {
      top: 55%;
    }

    @media (max-width: 768px) {
      #fg1 {
        top: 13%;
      }
    }

    #fg2 {
      top: 300%;
    }

    @media (max-width: 768px) {
      #fg2 {
        top: 50%;
      }
    }

    .foreground img {
      width: 100%;
      height: auto;
      display: block;
    }

    .spacer {
      height: 300vh;
    }

    /* Desktop features - with line and highlighting */
    .features {
      position: fixed;
      left: 10%;
      top: 50%;
      transform: translateY(-50%);
      z-index: 5;
      display: flex;
      flex-direction: row;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .features-line {
      width: 4px;
      background: rgba(255, 255, 255, 0.3);
      margin-right: 20px;
      position: relative;
    }

    .features-line::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: var(--line-progress, 0%);
      background: #00ff88;
      transition: height 0.3s ease;
    }

    .features-scroll {
      display: flex;
      flex-direction: row;
    }

    .features-list {
      display: flex;
      flex-direction: column;
      gap: 2vh;
    }

    .feature {
      font-family: 'Questrial', sans-serif;
      font-size: 2.5vw;
      color: rgba(255, 255, 255, 0.5);
      text-shadow: 0 0 30px rgba(0,0,0,0.9);
      transition: color 0.3s ease, opacity 0.6s ease, transform 0.6s ease;
      background: rgba(0, 0, 0, 0.2);
      padding: 1vh 2vw;
      border-radius: 8px;
    }

    .feature.active {
      color: #00ff88;
    }

    .feature.passed {
      color: white;
    }

    /* Mobile features - original slide-in behavior */
    @media (max-width: 768px) {
      .features {
        left: 50%;
        transform: translateX(-50%);
        width: 95%;
        left: 2.5%;
        flex-direction: column;
        gap: 3vh;
      }
      .features-scroll {
        display: contents;
      }
      .features-line {
        display: none;
      }
      .features-list {
        display: contents;
      }
      .feature {
        font-size: 5vw;
        color: white;
        transition: opacity 0.6s ease, transform 0.6s ease;
        display: flex;
        align-items: center;
        gap: 3vw;
      }
      .feature::before {
        content: '◆';
        font-size: 4vw;
        flex-shrink: 0;
      }
      .feature:nth-child(1)::before { color: #ff6b6b; }
      .feature:nth-child(2)::before { color: #4ecdc4; }
      .feature:nth-child(3)::before { color: #ffe66d; }
      .feature:nth-child(4)::before { color: #95e1d3; }
      .feature:nth-child(5)::before { color: #dda0dd; }
      .feature:nth-child(odd) {
        transform: translateX(-100vw);
      }
      .feature:nth-child(even) {
        transform: translateX(100vw);
      }
    }

    .title {
      position: fixed;
      bottom: 10%;
      left: 0;
      width: 100%;
      text-align: center;
      z-index: 10;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .title h1 {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 6vw;
      color: white;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      text-shadow:
        -1px -1px 0 black,
        1px -1px 0 black,
        -1px 1px 0 black,
        1px 1px 0 black,
        0 0 40px rgba(0,0,0,0.8);
    }

    .title .subtitle {
      font-family: 'Noto Sans JP', sans-serif;
      font-weight: 900;
      font-size: 2.5vw;
      color: white;
      letter-spacing: 0.2em;
      -webkit-text-stroke: 4px black;
      paint-order: stroke fill;
      margin-top: 0.5em;
    }

    .cta {
      margin-top: 2em;
      padding: 1em 3em;
      font-family: 'Orbitron', sans-serif;
      font-size: 1.2vw;
      color: white;
      background: transparent;
      border: 2px solid white;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      transition: all 0.3s ease;
    }

    .cta:hover {
      background: white;
      color: black;
    }

    @media (max-width: 768px) {
      .title {
        bottom: auto;
        top: 5px;
        padding: 0 5%;
        z-index: 100;
        opacity: 1 !important;
      }
      .title h1 {
        font-size: 8vw;
        margin-bottom: 0.3em;
      }
      .title .subtitle {
        font-size: 5vw;
        margin-bottom: 0.5em;
      }
      .title .cta {
        display: none;
      }
    }

    .mobile-cta {
      display: none;
    }

    @media (max-width: 768px) {
      .mobile-cta {
        display: block;
        position: fixed;
        bottom: 20px;
        left: 0;
        width: 100%;
        text-align: center;
        z-index: 100;
        opacity: 0;
        transition: opacity 0.5s ease;
      }
      .mobile-cta .cta {
        font-size: 4vw;
        padding: 0.8em 2em;
      }
    }

    .tagline {
      position: fixed;
      top: 15%;
      left: 0;
      width: 100%;
      text-align: center;
      z-index: 10;
      opacity: 0;
      transition: opacity 1s ease;
    }

    .tagline.visible {
      opacity: 1;
    }

    @media (max-width: 768px) {
      .tagline.visible {
        opacity: 0;
      }
    }

    .tagline p {
      font-family: 'Questrial', sans-serif;
      font-size: 3vw;
      color: white;
      text-shadow: 0 0 20px rgba(0,0,0,0.8);
    }

    @media (max-width: 768px) {
      .tagline {
        top: 27%;
        opacity: 0;
        transition: opacity 0.5s ease;
      }
      .tagline p {
        font-size: 6vw;
      }
    }

    .loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 9999;
      pointer-events: auto;
    }

    .loader.hidden {
      pointer-events: none;
    }

    .curtain {
      position: absolute;
      top: 0;
      width: 50%;
      height: 100%;
      background: #000;
      transition: transform 1.2s cubic-bezier(0.77, 0, 0.175, 1);
    }

    .curtain-left {
      left: 0;
    }

    .curtain-right {
      right: 0;
    }

    .loader.open .curtain-left {
      transform: translateX(-100%);
    }

    .loader.open .curtain-right {
      transform: translateX(100%);
    }

    .loader-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10000;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: opacity 0.3s ease;
    }

    .loader.open .loader-content {
      opacity: 0;
    }

    .spinner-btn {
      width: 50px;
      height: 50px;
      border: 2px solid rgba(255,255,255,0.2);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      cursor: default;
    }

    .spinner-btn span {
      font-family: 'Orbitron', sans-serif;
      font-size: 1vw;
      color: white;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .spinner-btn.morph {
      width: 150px;
      height: 50px;
      border-radius: 4px;
      border-color: white;
      animation: none;
      cursor: pointer;
    }

    .spinner-btn.morph span {
      opacity: 1;
    }

    .spinner-btn.morph:hover {
      background: white;
    }

    .spinner-btn.morph:hover span {
      color: black;
    }

    .loading-percent {
      margin-top: 20px;
      font-family: 'Questrial', sans-serif;
      font-size: 1.5vw;
      color: white;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="loader">
    <div class="curtain curtain-left"></div>
    <div class="curtain curtain-right"></div>
    <div class="loader-content">
      <button class="spinner-btn"><span>Enter</span></button>
      <div class="loading-percent">0%</div>
    </div>
  </div>
  <div class="background"></div>
  <div class="tagline">
    <p>like WSB found a battle mecha.</p>
  </div>
  <div class="foreground" id="fg1">
    <img src="assets/foreground.png" alt="Bridge">
  </div>
  <div class="features">
    <div class="features-scroll">
      <div class="features-line"></div>
      <div class="features-list">
        <div class="feature">Time travel to relive "whatif" trades</div>
        <div class="feature">Summon algo trading bots Ϟ(๑⚈ ․̫ ⚈๑)⋆</div>
        <div class="feature">Mind link with AI symbiotes</div>
        <div class="feature">Escape the simulator and livetrade</div>
        <div class="feature">Party like it's 1999 with other questers</div>
      </div>
    </div>
  </div>
  <div class="foreground" id="fg2">
    <img src="assets/foreground2.png" alt="Bridge 2">
  </div>
  <div class="title">
    <h1>marketmecha</h1>
    <p class="subtitle">マーケット メカニック</p>
    <button class="cta">Enter</button>
  </div>
  <div class="spacer"></div>
  <div class="mobile-cta">
    <button class="cta">Enter</button>
  </div>

  <script>
    const loader = document.querySelector('.loader');
    const bg = document.querySelector('.background');
    const fg1 = document.getElementById('fg1');
    const fg2 = document.getElementById('fg2');
    const tagline = document.querySelector('.tagline');
    const title = document.querySelector('.title');
    const spacer = document.querySelector('.spacer');
    const features = document.querySelector('.features');
    const featuresLine = document.querySelector('.features-line');
    const featuresScroll = document.querySelector('.features-scroll');
    const featureItems = document.querySelectorAll('.feature');
    const mobileCta = document.querySelector('.mobile-cta');

    // Track loading of all assets
    const imagesToLoad = ['assets/bg_2.png', 'assets/bg_3.png', 'assets/foreground.png', 'assets/foreground2.png'];
    const totalAssets = imagesToLoad.length + 2;
    let loadedCount = 0;
    let fontsLoaded = false;
    let audioLoaded = false;
    let bgImg;
    const loadingPercent = document.querySelector('.loading-percent');

    function updatePercent() {
      let loaded = loadedCount + (fontsLoaded ? 1 : 0) + (audioLoaded ? 1 : 0);
      const percent = Math.round((loaded / totalAssets) * 100);
      loadingPercent.textContent = percent + '%';
    }

    // Audio setup
    const audio = new Audio('assets/rico.mp3');
    audio.loop = true;
    audio.volume = 0;
    audio.addEventListener('canplaythrough', () => {
      if (!audioLoaded) {
        audioLoaded = true;
        updatePercent();
        checkAllLoaded();
      }
    });

    setTimeout(() => {
      if (!audioLoaded) {
        audioLoaded = true;
        updatePercent();
        checkAllLoaded();
      }
    }, 3000);

    const spinnerBtn = document.querySelector('.spinner-btn');

    function checkAllLoaded() {
      if (loadedCount === imagesToLoad.length && fontsLoaded && audioLoaded) {
        spinnerBtn.classList.add('morph');
      }
    }

    spinnerBtn.addEventListener('click', function() {
      if (!spinnerBtn.classList.contains('morph')) return;
      audio.play().catch(e => console.log('Audio play failed:', e));

      let volume = 0;
      const fadeIn = setInterval(() => {
        volume += 0.02;
        if (volume >= 1) {
          volume = 1;
          clearInterval(fadeIn);
        }
        audio.volume = volume;
      }, 50);

      loader.classList.add('open');

      setTimeout(() => {
        loader.classList.add('hidden');
        tagline.classList.add('visible');
      }, 1200);
    });

    imagesToLoad.forEach(src => {
      const img = new Image();
      img.src = src;
      img.onload = function() {
        loadedCount++;
        const isMobile = window.innerWidth <= 768;
        if ((isMobile && src === 'assets/bg_3.png') || (!isMobile && src === 'assets/bg_2.png')) {
          bgImg = img;
          const aspectRatio = bgImg.height / bgImg.width;
          const bgHeight = window.innerWidth * aspectRatio;
          const parallaxSpeed = isMobile ? 1.0 : 0.5;
          const scrollNeeded = (bgHeight - window.innerHeight) / parallaxSpeed;
          spacer.style.height = scrollNeeded + window.innerHeight + 'px';
        }
        updatePercent();
        checkAllLoaded();
      };
    });

    document.fonts.ready.then(() => {
      fontsLoaded = true;
      updatePercent();
      checkAllLoaded();
    });

    window.addEventListener('scroll', function() {
      const scrollY = window.scrollY;
      const isMobile = window.innerWidth <= 768;

      // Background parallax
      const bgParallax = isMobile ? 1.0 : 0.5;
      bg.style.backgroundPositionY = -(scrollY * bgParallax) + 'px';

      // Foreground 1
      const fg1Start = isMobile ? 13 : 55;
      const fg1Speed = isMobile ? 1.15 : 0.7;
      fg1.style.top = `calc(${fg1Start}% - ${scrollY * fg1Speed}px)`;

      // Tagline
      const taglineStart = isMobile ? 27 : 15;
      const taglineSpeed = isMobile ? 1.05 : 0.7;
      tagline.style.top = `calc(${taglineStart}% - ${scrollY * taglineSpeed}px)`;

      if (isMobile) {
        tagline.style.opacity = scrollY > 40 ? 1 : 0;
        mobileCta.style.opacity = scrollY > 200 ? 1 : 0;
      }

      // Foreground 2
      const fg2Start = isMobile ? 50 : 400;
      const fg2Speed = isMobile ? 1.4 : 0.75;
      fg2.style.top = `calc(${fg2Start}% - ${scrollY * fg2Speed}px)`;

      // Features section
      const itemCount = featureItems.length;

      if (isMobile) {
        // MOBILE: Original behavior - drift upward + slide in from sides
        const featuresStartY = 73;
        const featuresDriftSpeed = 0.6;
        const featuresY = featuresStartY - (scrollY * featuresDriftSpeed / window.innerHeight * 100);
        features.style.top = featuresY + '%';
        features.style.left = '2.5%';
        features.style.transform = 'none';
        features.style.opacity = '1';

        // Calculate progress for slide-in
        const featuresStart = window.innerHeight * 0.15;
        const featuresEnd = window.innerHeight * 0.35;
        const featuresProgress = (scrollY - featuresStart) / (featuresEnd - featuresStart);

        // Slide in each feature sequentially
        featureItems.forEach((item, index) => {
          const itemDelay = 0.01;
          const itemStart = index * itemDelay;
          const isOdd = index % 2 === 0;
          const offScreen = isOdd ? -100 : 100;

          if (featuresProgress > itemStart) {
            const slideProgress = Math.min((featuresProgress - itemStart) / 0.2, 1);
            item.style.opacity = slideProgress;
            item.style.transform = `translateX(${offScreen * (1 - slideProgress)}vw)`;
          } else {
            item.style.opacity = 0;
            item.style.transform = `translateX(${offScreen}vw)`;
          }
          item.classList.remove('active', 'passed');
        });

      } else {
        // DESKTOP: New behavior - anchored with line and highlighting
        const featuresAnchor = 145;
        const featuresSpeed = 0.35;

        const featuresTop = featuresAnchor - (scrollY * featuresSpeed / window.innerHeight * 100);
        features.style.top = `${featuresTop}vh`;
        features.style.left = '10%';
        features.style.transform = 'translateY(-50%)';
        features.style.opacity = '1';

        // Reset inline styles that mobile might have set
        featureItems.forEach(item => {
          item.style.opacity = '';
          item.style.transform = '';
        });

        // Scrolling through items
        const featuresCenterScroll = (featuresAnchor - 50) * window.innerHeight / 100 / featuresSpeed;
        const readingRange = window.innerHeight * 1.5;
        const featuresReadStart = featuresCenterScroll;
        const featuresReadEnd = featuresCenterScroll + readingRange;

        if (scrollY >= featuresReadStart && scrollY <= featuresReadEnd) {
          const readProgress = (scrollY - featuresReadStart) / (featuresReadEnd - featuresReadStart);
          const itemHeight = 8;
          const maxOffset = (itemCount - 1) * itemHeight;
          const listOffset = readProgress * maxOffset;
          featuresScroll.style.transform = `translateY(-${listOffset}vh)`;
        } else if (scrollY < featuresReadStart) {
          featuresScroll.style.transform = 'translateY(0)';
        } else {
          const itemHeight = 8;
          const maxOffset = (itemCount - 1) * itemHeight;
          featuresScroll.style.transform = `translateY(-${maxOffset}vh)`;
        }

        // Highlight items based on 50% viewport threshold
        const viewportThreshold = window.innerHeight * 0.5;
        let lastPassedIndex = -1;

        featureItems.forEach((item, index) => {
          const rect = item.getBoundingClientRect();
          const itemCenter = rect.top + rect.height / 2;

          if (itemCenter < viewportThreshold) {
            item.classList.remove('active');
            item.classList.add('passed');
            lastPassedIndex = index;
          } else {
            item.classList.remove('active', 'passed');
          }
        });

        const activeItemIndex = lastPassedIndex + 1;
        let hasActiveItem = false;
        if (activeItemIndex < itemCount) {
          const activeRect = featureItems[activeItemIndex].getBoundingClientRect();
          const activeCenter = activeRect.top + activeRect.height / 2;
          if (lastPassedIndex >= 0 || activeCenter < viewportThreshold + activeRect.height) {
            featureItems[activeItemIndex].classList.add('active');
            hasActiveItem = true;
          }
        } else if (lastPassedIndex === itemCount - 1) {
          featureItems[lastPassedIndex].classList.remove('passed');
          featureItems[lastPassedIndex].classList.add('active');
          hasActiveItem = true;
        }

        let lineProgress = 0;
        if (lastPassedIndex >= 0) {
          lineProgress = ((lastPassedIndex + 1 + (hasActiveItem ? 1 : 0)) / itemCount) * 100;
        } else if (hasActiveItem) {
          lineProgress = (1 / itemCount) * 100;
        }
        featuresLine.style.setProperty('--line-progress', Math.min(lineProgress, 100) + '%');
      }

      // Title
      const maxScroll = document.body.scrollHeight - window.innerHeight;
      const scrollProgress = maxScroll > 0 ? scrollY / maxScroll : 0;

      if (isMobile) {
        title.style.top = `calc(5px - ${scrollY * bgParallax}px)`;
      } else if (scrollProgress > 0.65) {
        const titleProgress = (scrollProgress - 0.65) / 0.35;
        title.style.opacity = Math.min(titleProgress, 1);
        title.style.transform = `translateY(${(1 - Math.min(titleProgress, 1)) * 15}vh)`;
      } else {
        title.style.opacity = 0;
        title.style.transform = 'translateY(15vh)';
      }
    });

    window.addEventListener('resize', function() {
      if (bgImg) {
        const aspectRatio = bgImg.height / bgImg.width;
        const bgHeight = window.innerWidth * aspectRatio;
        const isMobile = window.innerWidth <= 768;
        const parallaxSpeed = isMobile ? 1.0 : 0.5;
        const scrollNeeded = (bgHeight - window.innerHeight) / parallaxSpeed;
        spacer.style.height = scrollNeeded + window.innerHeight + 'px';
      }
    });

    // Trigger scroll handler on page load
    window.dispatchEvent(new Event('scroll'));
  </script>
</body>
</html>
